<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>文章导航布局（固定显示版）</title>

  <style>
    /* 基础样式与变量定义 */
    :root {
      --primary: #2c3e50;
      --primary-light: #34495e;
      --primary-accent: #3498db;
      --secondary: #7f8c8d;
      --light-bg: #f5f7fa;
      --white: #ffffff;
      --gray-light: #ecf0f1;
      --gray: #bdc3c7;
      --text-dark: #2c3e50;
      --text-medium: #7f8c8d;
      --text-light: #95a5a6;
      --border-color: #e1e4e8;
      --shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
      --shadow-hover: 0 4px 15px rgba(0, 0, 0, 0.12);
      --transition: all 0.3s ease;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: "Helvetica Neue", Arial, sans-serif;
      color: var(--text-dark);
      background-color: var(--light-bg);
      line-height: 1.6;
      overflow-x: hidden;
      padding-top: 60px; /* 为顶部导航栏预留空间 */
    }

    /* 布局基础类 */
    .container {
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 1rem;
    }

    .flex {
      display: flex;
    }

    .items-center {
      align-items: center;
    }

    .justify-between {
      justify-content: space-between;
    }

    .fixed {
      position: fixed;
    }

    .relative {
      position: relative;
    }

    .absolute {
      position: absolute;
    }

    .top-0 {
      top: 0;
    }

    .left-0 {
      left: 0;
    }

    .right-0 {
      right: 0;
    }

    .bottom-0 {
      bottom: 0;
    }

    .w-full {
      width: 100%;
    }

    .h-full {
      height: 100%;
    }

    .overflow-hidden {
      overflow: hidden;
    }

    .overflow-y-auto {
      overflow-y: auto;
    }

    .scrollbar-hide {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }

    .scrollbar-hide::-webkit-scrollbar {
      display: none;
    }

    .text-center {
      text-align: center;
    }

    .hidden {
      display: none !important;
    }

    .block {
      display: block;
    }

    /* 间距类 */
    .m-1 { margin: 0.25rem; }
    .m-2 { margin: 0.5rem; }
    .m-4 { margin: 1rem; }
    .m-6 { margin: 1.5rem; }
    .m-8 { margin: 2rem; }

    .mt-1 { margin-top: 0.25rem; }
    .mt-2 { margin-top: 0.5rem; }
    .mt-4 { margin-top: 1rem; }
    .mt-6 { margin-top: 1.5rem; }
    .mt-8 { margin-top: 2rem; }
    .mt-16 { margin-top: 4rem; }

    .mb-1 { margin-bottom: 0.25rem; }
    .mb-2 { margin-bottom: 0.5rem; }
    .mb-4 { margin-bottom: 1rem; }
    .mb-6 { margin-bottom: 1.5rem; }
    .mb-8 { margin-bottom: 2rem; }
    .mb-12 { margin-bottom: 3rem; }

    .ml-4 { margin-left: 1rem; }
    .mr-4 { margin-right: 1rem; }

    .p-1 { padding: 0.25rem; }
    .p-2 { padding: 0.5rem; }
    .p-4 { padding: 1rem; }
    .p-6 { padding: 1.5rem; }
    .p-8 { padding: 2rem; }

    .py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
    .py-3 { padding-top: 0.75rem; padding-bottom: 0.75rem; }
    .py-4 { padding-top: 1rem; padding-bottom: 1rem; }
    .py-6 { padding-top: 1.5rem; padding-bottom: 1.5rem; }
    .py-8 { padding-top: 2rem; padding-bottom: 2rem; }

    .px-2 { padding-left: 0.5rem; padding-right: 0.5rem; }
    .px-3 { padding-left: 0.75rem; padding-right: 0.75rem; }
    .px-4 { padding-left: 1rem; padding-right: 1rem; }
    .px-6 { padding-left: 1.5rem; padding-right: 1.5rem; }

    .space-y-1 > * + * { margin-top: 0.25rem; }
    .space-y-2 > * + * { margin-top: 0.5rem; }
    .space-y-4 > * + * { margin-top: 1rem; }
    .space-y-6 > * + * { margin-top: 1.5rem; }

    .space-x-2 > * + * { margin-left: 0.5rem; }
    .space-x-4 > * + * { margin-left: 1rem; }
    .space-x-6 > * + * { margin-left: 1.5rem; }

    /* 文本样式类 */
    .text-xs { font-size: 0.75rem; }
    .text-sm { font-size: 0.875rem; }
    .text-base { font-size: 1rem; }
    .text-lg { font-size: 1.125rem; }
    .text-xl { font-size: 1.25rem; }
    .text-2xl { font-size: 1.5rem; }
    .text-3xl { font-size: 1.875rem; }
    .text-4xl { font-size: 2.25rem; }

    .font-light { font-weight: 300; }
    .font-normal { font-weight: 400; }
    .font-medium { font-weight: 500; }
    .font-semibold { font-weight: 600; }
    .font-bold { font-weight: 700; }

    .text-primary { color: var(--primary); }
    .text-primary-accent { color: var(--primary-accent); }
    .text-secondary { color: var(--secondary); }
    .text-white { color: var(--white); }
    .text-gray { color: var(--gray); }

    /* 背景与边框类 */
    .bg-white { background-color: var(--white); }
    .bg-light { background-color: var(--light-bg); }
    .bg-primary { background-color: var(--primary); }
    .bg-primary-accent { background-color: var(--primary-accent); }
    .bg-gray-light { background-color: var(--gray-light); }

    .border { border: 1px solid var(--border-color); }
    .border-b { border-bottom: 1px solid var(--border-color); }
    .border-r { border-right: 1px solid var(--border-color); }
    .border-l-4 { border-left: 4px solid var(--primary-accent); }

    .rounded { border-radius: 4px; }
    .rounded-md { border-radius: 6px; }
    .rounded-lg { border-radius: 8px; }

    /* 阴影与过渡类 */
    .shadow { box-shadow: var(--shadow); }
    .shadow-hover { transition: var(--transition); }
    .shadow-hover:hover { box-shadow: var(--shadow-hover); }

    .transition { transition: var(--transition); }

    /* 顶部导航栏 */
    #top-nav {
      height: 60px;
      z-index: 50;
      background-color: var(--white);
      box-shadow: var(--shadow);
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-weight: 600;
      font-size: 1.25rem;
      color: var(--primary);
      text-decoration: none;
    }

    .nav-link {
      color: var(--text-medium);
      text-decoration: none;
      transition: var(--transition);
      font-weight: 500;
    }

    .nav-link:hover {
      color: var(--primary-accent);
    }

    .nav-link.active {
      color: var(--primary-accent);
    }

    .menu-toggle {
      background: none;
      border: none;
      font-size: 1.5rem;
      color: var(--primary);
      cursor: pointer;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0.5rem 1rem;
      border-radius: 4px;
      font-weight: 500;
      text-decoration: none;
      cursor: pointer;
      transition: var(--transition);
      border: none;
    }

    .btn-primary {
      background-color: var(--primary-accent);
      color: var(--white);
    }

    .btn-primary:hover {
      background-color: #2980b9;
    }

    /* 左侧章节导航 - 始终显示 */
    #left-sidebar {
      width: 240px;
      position: fixed;
      top: 60px;
      bottom: 0;
      background-color: var(--white);
      border-right: 1px solid var(--border-color);
      z-index: 40;
      overflow-y: auto;
      scrollbar-hide: auto;
    }

    /* 响应式调整左侧导航宽度 */
    @media (max-width: 1024px) {
      #left-sidebar {
        width: 200px;
      }
    }

    @media (max-width: 768px) {
      #left-sidebar {
        width: 160px;
      }
    }

    .chapter-title {
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--primary);
      padding-bottom: 0.5rem;
      border-bottom: 1px solid var(--border-color);
    }

    .chapter-link {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.75rem 1rem;
      color: var(--text-medium);
      text-decoration: none;
      transition: var(--transition);
      border-left: 3px solid transparent;
      font-size: 0.95rem;
    }

    .chapter-link:hover {
      background-color: var(--light-bg);
      color: var(--primary-accent);
    }

    .chapter-link.active {
      background-color: rgba(52, 152, 219, 0.1);
      color: var(--primary-accent);
      border-left-color: var(--primary-accent);
    }

    /* 主内容区 - 始终为左侧导航留出空间 */
    .main-content {
      margin-left: 240px; /* 与左侧导航宽度一致 */
      padding: 2rem;
      min-height: calc(100vh - 60px);
    }

    /* 响应式调整主内容区margin */
    @media (max-width: 1024px) {
      .main-content {
        margin-left: 200px;
        padding: 1.5rem;
      }
    }

    @media (max-width: 768px) {
      .main-content {
        margin-left: 160px;
        padding: 1rem;
      }
    }

    /* 为右侧导航留出空间 */
    @media (min-width: 1200px) {
      .main-content {
        padding-right: 260px; /* 右侧导航宽度+间距 */
      }
    }

    .article-header {
      margin-bottom: 3rem;
      text-align: center;
    }

    .article-title {
      font-size: 2.5rem;
      margin-bottom: 1rem;
      color: var(--primary);
    }

    .article-meta {
      color: var(--text-medium);
      font-size: 0.9rem;
    }

    /* Markdown内容样式 */
    .markdown-content h2 {
      font-size: 1.8rem;
      margin-top: 2.5rem;
      margin-bottom: 1.5rem;
      color: var(--primary);
      padding-bottom: 0.5rem;
      border-bottom: 1px solid var(--border-color);
    }

    .markdown-content h3 {
      font-size: 1.4rem;
      margin-top: 2rem;
      margin-bottom: 1rem;
      color: var(--primary-light);
    }

    .markdown-content p {
      margin-bottom: 1.25rem;
      line-height: 1.7;
    }

    .markdown-content ul,
    .markdown-content ol {
      margin-bottom: 1.25rem;
      padding-left: 1.5rem;
    }

    .markdown-content ul {
      list-style-type: disc;
    }

    .markdown-content ol {
      list-style-type: decimal;
    }

    .markdown-content li {
      margin-bottom: 0.5rem;
    }

    .markdown-content a {
      color: var(--primary-accent);
      text-decoration: none;
    }

    .markdown-content a:hover {
      text-decoration: underline;
    }

    .markdown-content blockquote {
      border-left: 4px solid var(--primary-accent);
      padding: 0.5rem 1rem;
      margin: 1.5rem 0;
      background-color: rgba(52, 152, 219, 0.05);
      color: var(--text-medium);
    }

/* 代码块样式 */
.markdown-content pre {
    background-color: #2d3748;
    color: #e2e8f0;
    border-radius: 0.375rem;
    padding: 1rem;
    margin-bottom: 1.25rem;
    overflow-x: auto;
    font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
    font-size: 0.875rem;
    line-height: 1.5;
}

.markdown-content code {
    background-color: #edf2f7;
    color: #2d3748;
    padding: 0.125rem 0.25rem;
    border-radius: 0.25rem;
    font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
    font-size: 0.875rem;
}

.markdown-content pre code {
    background-color: transparent;
    padding: 0;
    color: inherit;
}

    .markdown-content table {
      width: 100%;
      border-collapse: collapse;
      margin: 1.5rem 0;
    }

    .markdown-content th,
    .markdown-content td {
      padding: 0.75rem;
      text-align: left;
      border-bottom: 1px solid var(--border-color);
    }

    .markdown-content th {
      background-color: var(--light-bg);
      font-weight: 600;
    }

    /* 右侧悬浮二级标题导航 - 始终显示 */
    #right-sidebar {
      width: 240px;
      position: fixed;
      top: 80px;
      bottom: 80px;
      right: 20px;
      background-color: var(--white);
      border-radius: 8px;
      box-shadow: var(--shadow);
      padding: 1rem;
      overflow-y: auto;
      z-index: 30;
    }

    /* 小屏幕下调整右侧导航位置和大小 */
    @media (max-width: 1199px) and (min-width: 769px) {
      #right-sidebar {
        width: 200px;
        font-size: 0.9rem;
      }
    }

    @media (max-width: 768px) {
      #right-sidebar {
        width: 140px;
        right: 10px;
        padding: 0.75rem;
        font-size: 0.85rem;
      }
    }

    .toc-title {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 1rem;
      color: var(--primary);
      padding-bottom: 0.5rem;
      border-bottom: 1px solid var(--border-color);
    }

    .toc-link {
      display: block;
      padding: 0.35rem 0.5rem;
      color: var(--text-medium);
      text-decoration: none;
      font-size: 0.9rem;
      border-radius: 4px;
      transition: var(--transition);
    }

    .toc-link:hover {
      background-color: var(--light-bg);
      color: var(--primary-accent);
    }

    .toc-link.active {
      background-color: rgba(52, 152, 219, 0.1);
      color: var(--primary-accent);
      font-weight: 500;
    }

    .toc-level-2 {
      padding-left: 1rem;
      font-size: 0.85rem;
    }

    /* 移除移动端控制按钮 */
    #toc-toggle, #sidebar-toggle, #overlay {
      display: none !important;
    }
  </style>
</head>

<body>
  <!-- 顶部导航栏 -->
  <header id="top-nav" class="fixed top-0 left-0 right-0 bg-white shadow">
    <div class="container flex items-center justify-between h-full px-4">
      <!-- 左侧Logo -->
      <div class="flex items-center space-x-4">
        <a href="#" class="logo">
          <span>Sprival</span>
        </a>
      </div>

      <!-- 中间导航链接 -->
      <nav class="md:flex items-center space-x-6">
        <a href="#" class="nav-link">sprival</a>
        <a href="#" class="nav-link">blog</a>
        <a href="#" class="nav-link">about</a>
      </nav>

      <!-- 右侧功能区 -->
      <div class="flex items-center space-x-4">
      </div>
    </div>
  </header>

  <!-- 主内容区 -->
  <main class="main-content">
    <div class="container max-w-4xl">
      <article class="markdown-content bg-white rounded-lg shadow p-6 md:p-8">
          <h1>SQL执行</h1>
<p>mybatis-plus查询方法有三种</p>
<p>一种是继承BaseMapper，可以称之为mybatis-plus内置查询</p>
<p>一种是继承ServiceImpl，这个类的方法是对BaseMapper的增强，底层也是调用BaseMapper的方法，也称之为mybatis-plus内置查询</p>
<p>一种是mybatis方式，即注解和xml。可以称之为mybatis原生方式</p>
<p>无论是通过那种方式执行查询，首先会根据@DS注解进行动态数据源切换。</p>
<p>对于mybatis-plus内置查询，会通过代理的方式用mybatis的SqlSession执行SQL。</p>
<p>执行的SQL由两部分组成，一个是预生成的MappedStatement，也就是SQL模板。一个是Wrapper对象，也就是动态参数。mybatis-plus生成的SQL模板内的占位符不仅仅有查询参数，还有查询字段，SQL片段这种占位符
然后通过Wrapper动态生成where条件，查询字段等替换掉SQL模板的占位符，构成完整的SQL。参见<a href="SQL模板注册.md">SQL模板注册</a></p>
<p>SqlSession使用的DataSource是mybatis-plus注入的DynamicRoutingDataSource。DynamicRoutingDataSource底层使用的数据源可以是Hikari, Druid。。。参见<a href="DataSource.md">DataSource</a>。</p>
<h2>DynamicDataSourceAutoConfiguration</h2>
<p>dynamicDatasourceAnnotationAdvisor()方法将DynamicDataSourceAnnotationInterceptor注册为Advisor类型的Bean，DS注解类作为Pointcut</p>
<pre><code class="language-java">@Slf4j
@Configuration
@EnableConfigurationProperties(DynamicDataSourceProperties.class)
@AutoConfigureBefore(value = DataSourceAutoConfiguration.class, name = &quot;com.alibaba.druid.spring.boot.autoconfigure.DruidDataSourceAutoConfigure&quot;)
@Import(value = {DruidDynamicDataSourceConfiguration.class, DynamicDataSourceCreatorAutoConfiguration.class})
@ConditionalOnProperty(prefix = DynamicDataSourceProperties.PREFIX, name = &quot;enabled&quot;, havingValue = &quot;true&quot;, matchIfMissing = true)
public class DynamicDataSourceAutoConfiguration implements InitializingBean {
    @Role(BeanDefinition.ROLE_INFRASTRUCTURE)
    @Bean
    @ConditionalOnProperty(prefix = DynamicDataSourceProperties.PREFIX + &quot;.aop&quot;, name = &quot;enabled&quot;, havingValue = &quot;true&quot;, matchIfMissing = true)
    public Advisor dynamicDatasourceAnnotationAdvisor(DsProcessor dsProcessor) {
        DynamicDatasourceAopProperties aopProperties = properties.getAop();
        DynamicDataSourceAnnotationInterceptor interceptor = new DynamicDataSourceAnnotationInterceptor(aopProperties.getAllowedPublicOnly(), dsProcessor);
        DynamicDataSourceAnnotationAdvisor advisor = new DynamicDataSourceAnnotationAdvisor(interceptor, DS.class);
        advisor.setOrder(aopProperties.getOrder());
        return advisor;
    }
}
</code></pre>
<h2>AbstractAdvisorAutoProxyCreator</h2>
<p>通过getAdvicesAndAdvisorsForBean为使用了@DS注解的bean创建cglib代理，执行所有方法的时候，都会执行到DynamicDataSourceAnnotationInterceptor</p>
<pre><code class="language-java">public abstract class AbstractAdvisorAutoProxyCreator extends AbstractAutoProxyCreator {
    @Override
    @Nullable
    protected Object[] getAdvicesAndAdvisorsForBean(
           Class&lt;?&gt; beanClass, String beanName, @Nullable TargetSource targetSource) {

        List&lt;Advisor&gt; advisors = findEligibleAdvisors(beanClass, beanName);
        if (advisors.isEmpty()) {
           return DO_NOT_PROXY;
        }
        return advisors.toArray();
    }
}
</code></pre>
<h2>DynamicDataSourceAnnotationInterceptor</h2>
<ul>
<li>
<p>DynamicDataSourceAnnotationInterceptor实现MethodInterceptor接口，MethodInterceptor继承自Interceptor接口，Interceptor继承自Advice接口。因此，DynamicDataSourceAnnotationInterceptor就是AOP的Advice</p>
</li>
<li>
<p>Spring会调用到DynamicDataSourceAnnotationInterceptor的invoke方法，将当前注解的数据源设置到DynamicDataSourceContextHolder类的当前线程，并且这个线程使用的数据结构是栈</p>
</li>
</ul>
<pre><code class="language-java">public class DynamicDataSourceAnnotationInterceptor implements MethodInterceptor {
    @Override
    public Object invoke(MethodInvocation invocation) throws Throwable {
        String dsKey = determineDatasourceKey(invocation);
        DynamicDataSourceContextHolder.push(dsKey);
        try {
            return invocation.proceed();
        } finally {
            DynamicDataSourceContextHolder.poll();
        }
    }
}

public final class DynamicDataSourceContextHolder {
    private static final ThreadLocal&lt;Deque&lt;String&gt;&gt; LOOKUP_KEY_HOLDER = new NamedThreadLocal&lt;Deque&lt;String&gt;&gt;(&quot;dynamic-datasource&quot;) {
        @Override
        protected Deque&lt;String&gt; initialValue() {
            return new ArrayDeque&lt;&gt;();
        }
    };

    public static String push(String ds) {
        String dataSourceStr = StringUtils.isEmpty(ds) ? &quot;&quot; : ds;
        LOOKUP_KEY_HOLDER.get().push(dataSourceStr);
        return dataSourceStr;
    }

    public static void poll() {
        Deque&lt;String&gt; deque = LOOKUP_KEY_HOLDER.get();
        deque.poll();
        if (deque.isEmpty()) {
            LOOKUP_KEY_HOLDER.remove();
        }
    }
}
</code></pre>
<h2>TradeProvider</h2>
<ul>
<li>TradeProvider 继承了ServiceImpl，ServiceImpl实现了IService接口。</li>
<li>TradeProvider.list() =&gt; IService.list() =&gt; this.getBaseMapper().selectList(queryWrapper)</li>
<li>getBaseMapper()返回的mapper就是MapperScan扫描并且注册的MybatisMapperProxy代理</li>
</ul>
<pre><code class="language-java">@Service
public class TradeProvider extends BaseTblProvider&lt;TradeMapper, Trade&gt; implements TradeContract {

}


public class ServiceImpl&lt;M extends BaseMapper&lt;T&gt;, T&gt; implements IService&lt;T&gt; {
    @Autowired
    protected M baseMapper;

    public M getBaseMapper() {
        return this.baseMapper;
    }
}

public interface IService&lt;T&gt; {
    default List&lt;T&gt; list(Wrapper&lt;T&gt; queryWrapper) {
        return this.getBaseMapper().selectList(queryWrapper);
    }

    default List&lt;T&gt; list() {
        return this.list(Wrappers.emptyWrapper());
    }
}
</code></pre>
<h2>MybatisMapperProxy</h2>
<p>MybatisMapperProxy 的 invoke调用的是MybatisMapperMethod的execute方法，</p>
<pre><code class="language-java">public class MybatisMapperProxy&lt;T&gt; implements InvocationHandler, Serializable {
    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
        try {
            if (Object.class.equals(method.getDeclaringClass())) {
                return method.invoke(this, args);
            } else {
                return cachedInvoker(method).invoke(proxy, method, args, sqlSession);
            }
        } catch (Throwable t) {
            throw ExceptionUtil.unwrapThrowable(t);
        }
    }

    private static class PlainMethodInvoker implements MapperMethodInvoker {
        private final MybatisMapperMethod mapperMethod;

        public PlainMethodInvoker(MybatisMapperMethod mapperMethod) {
            super();
            this.mapperMethod = mapperMethod;
        }

        @Override
        public Object invoke(Object proxy, Method method, Object[] args, SqlSession sqlSession) throws Throwable {
            return mapperMethod.execute(sqlSession, args);
        }
    }
}
</code></pre>
<h2>MybatisMapperMethod</h2>
<p>MybatisMapperMethod的execute()最终调用的是mybatis的sqlSession.select()，这个SqlSession就是之前Datasource适配注册的SqlTemplate</p>
<pre><code class="language-java">public class MybatisMapperMethod {
    public Object execute(SqlSession sqlSession, Object[] args) {
        Object result;
        switch (command.getType()) {
            case INSERT: {
                Object param = method.convertArgsToSqlCommandParam(args);
                result = rowCountResult(sqlSession.insert(command.getName(), param));
                break;
            }
            case UPDATE: {
                Object param = method.convertArgsToSqlCommandParam(args);
                result = rowCountResult(sqlSession.update(command.getName(), param));
                break;
            }
            case DELETE: {
                Object param = method.convertArgsToSqlCommandParam(args);
                result = rowCountResult(sqlSession.delete(command.getName(), param));
                break;
            }
            case SELECT:
                if (method.returnsVoid() &amp;&amp; method.hasResultHandler()) {
                    executeWithResultHandler(sqlSession, args);
                    result = null;
                } else if (method.returnsMany()) {
                    result = executeForMany(sqlSession, args);
                } else if (method.returnsMap()) {
                    result = executeForMap(sqlSession, args);
                } else if (method.returnsCursor()) {
                    result = executeForCursor(sqlSession, args);
                } else {
                    // TODO 这里下面改了
                    if (IPage.class.isAssignableFrom(method.getReturnType())) {
                        result = executeForIPage(sqlSession, args);
                        // TODO 这里上面改了
                    } else {
                        Object param = method.convertArgsToSqlCommandParam(args);
                        result = sqlSession.selectOne(command.getName(), param);
                        if (method.returnsOptional()
                                &amp;&amp; (result == null || !method.getReturnType().equals(result.getClass()))) {
                            result = Optional.ofNullable(result);
                        }
                    }
                }
                break;
            case FLUSH:
                result = sqlSession.flushStatements();
                break;
            default:
                throw new BindingException(&quot;Unknown execution method for: &quot; + command.getName());
        }
        if (result == null &amp;&amp; method.getReturnType().isPrimitive() &amp;&amp; !method.returnsVoid()) {
            throw new BindingException(&quot;Mapper method '&quot; + command.getName()
                    + &quot; attempted to return null from a method with a primitive return type (&quot; + method.getReturnType() + &quot;).&quot;);
        }
        return result;
    }
}   
</code></pre>
<h2>ibatis执行</h2>
<p>通过ASTProperty类和反射的方式执行到mybatis-plus的AbstractWrapper方法</p>
<pre><code class="language-java">public class ASTProperty extends SimpleNode implements NodeType {
    protected Object getValueBody(OgnlContext context, Object source) throws OgnlException {
        Object property = this.getProperty(context, source);
        Object result = OgnlRuntime.getProperty(context, source, property);
        if (result == null) {
            result = OgnlRuntime.getNullHandler(OgnlRuntime.getTargetClass(source)).nullPropertyValue(context, source, property);
        }

        return result;
    }
}

public abstract class AbstractWrapper&lt;T, R, Children extends AbstractWrapper&lt;T, R, Children&gt;&gt; extends Wrapper&lt;T&gt;
        implements Compare&lt;Children, R&gt;, Nested&lt;Children, Children&gt;, Join&lt;Children&gt;, Func&lt;Children, R&gt; {
    @Override
    public MergeSegments getExpression() {
        return expression;
    }

    public Map&lt;String, Object&gt; getParamNameValuePairs() {
        return paramNameValuePairs;
    }
}
</code></pre>
      </article>
    </div>
  </main>



  <script>
    // 元素获取
    const chapterLinks = document.querySelectorAll('.chapter-link');
    const tocLinks = document.querySelectorAll('.toc-link');
    const sections = document.querySelectorAll('section, h3[id]');

    // 滚动监听，高亮当前章节和目录项
    window.addEventListener('scroll', () => {
      let current = '';

      // 找到当前可见的最高章节
      sections.forEach(section => {
        const sectionTop = section.offsetTop;
        const sectionHeight = section.clientHeight;

        if (window.scrollY >= (sectionTop - 150)) {
          current = section.getAttribute('id');
        }
      });

      // 更新左侧章节导航高亮
      chapterLinks.forEach(link => {
        link.classList.remove('active');
        if (link.getAttribute('href').substring(1) === current ||
            current.startsWith(link.getAttribute('href').substring(1) + '-')) {
          link.classList.add('active');
        }
      });

      // 更新右侧目录导航高亮
      tocLinks.forEach(link => {
        link.classList.remove('active');
        if (link.getAttribute('href').substring(1) === current) {
          link.classList.add('active');
        }
      });
    });
  </script>
</body>
</html>
