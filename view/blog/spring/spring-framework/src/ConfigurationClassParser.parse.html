<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>文章导航布局（固定显示版）</title>

  <style>
    /* 基础样式与变量定义 */
    :root {
      --primary: #2c3e50;
      --primary-light: #34495e;
      --primary-accent: #3498db;
      --secondary: #7f8c8d;
      --light-bg: #f5f7fa;
      --white: #ffffff;
      --gray-light: #ecf0f1;
      --gray: #bdc3c7;
      --text-dark: #2c3e50;
      --text-medium: #7f8c8d;
      --text-light: #95a5a6;
      --border-color: #e1e4e8;
      --shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
      --shadow-hover: 0 4px 15px rgba(0, 0, 0, 0.12);
      --transition: all 0.3s ease;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: "Helvetica Neue", Arial, sans-serif;
      color: var(--text-dark);
      background-color: var(--light-bg);
      line-height: 1.6;
      overflow-x: hidden;
      padding-top: 60px; /* 为顶部导航栏预留空间 */
    }

    /* 布局基础类 */
    .container {
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 1rem;
    }

    .flex {
      display: flex;
    }

    .items-center {
      align-items: center;
    }

    .justify-between {
      justify-content: space-between;
    }

    .fixed {
      position: fixed;
    }

    .relative {
      position: relative;
    }

    .absolute {
      position: absolute;
    }

    .top-0 {
      top: 0;
    }

    .left-0 {
      left: 0;
    }

    .right-0 {
      right: 0;
    }

    .bottom-0 {
      bottom: 0;
    }

    .w-full {
      width: 100%;
    }

    .h-full {
      height: 100%;
    }

    .overflow-hidden {
      overflow: hidden;
    }

    .overflow-y-auto {
      overflow-y: auto;
    }

    .scrollbar-hide {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }

    .scrollbar-hide::-webkit-scrollbar {
      display: none;
    }

    .text-center {
      text-align: center;
    }

    .hidden {
      display: none !important;
    }

    .block {
      display: block;
    }

    /* 间距类 */
    .m-1 { margin: 0.25rem; }
    .m-2 { margin: 0.5rem; }
    .m-4 { margin: 1rem; }
    .m-6 { margin: 1.5rem; }
    .m-8 { margin: 2rem; }

    .mt-1 { margin-top: 0.25rem; }
    .mt-2 { margin-top: 0.5rem; }
    .mt-4 { margin-top: 1rem; }
    .mt-6 { margin-top: 1.5rem; }
    .mt-8 { margin-top: 2rem; }
    .mt-16 { margin-top: 4rem; }

    .mb-1 { margin-bottom: 0.25rem; }
    .mb-2 { margin-bottom: 0.5rem; }
    .mb-4 { margin-bottom: 1rem; }
    .mb-6 { margin-bottom: 1.5rem; }
    .mb-8 { margin-bottom: 2rem; }
    .mb-12 { margin-bottom: 3rem; }

    .ml-4 { margin-left: 1rem; }
    .mr-4 { margin-right: 1rem; }

    .p-1 { padding: 0.25rem; }
    .p-2 { padding: 0.5rem; }
    .p-4 { padding: 1rem; }
    .p-6 { padding: 1.5rem; }
    .p-8 { padding: 2rem; }

    .py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
    .py-3 { padding-top: 0.75rem; padding-bottom: 0.75rem; }
    .py-4 { padding-top: 1rem; padding-bottom: 1rem; }
    .py-6 { padding-top: 1.5rem; padding-bottom: 1.5rem; }
    .py-8 { padding-top: 2rem; padding-bottom: 2rem; }

    .px-2 { padding-left: 0.5rem; padding-right: 0.5rem; }
    .px-3 { padding-left: 0.75rem; padding-right: 0.75rem; }
    .px-4 { padding-left: 1rem; padding-right: 1rem; }
    .px-6 { padding-left: 1.5rem; padding-right: 1.5rem; }

    .space-y-1 > * + * { margin-top: 0.25rem; }
    .space-y-2 > * + * { margin-top: 0.5rem; }
    .space-y-4 > * + * { margin-top: 1rem; }
    .space-y-6 > * + * { margin-top: 1.5rem; }

    .space-x-2 > * + * { margin-left: 0.5rem; }
    .space-x-4 > * + * { margin-left: 1rem; }
    .space-x-6 > * + * { margin-left: 1.5rem; }

    /* 文本样式类 */
    .text-xs { font-size: 0.75rem; }
    .text-sm { font-size: 0.875rem; }
    .text-base { font-size: 1rem; }
    .text-lg { font-size: 1.125rem; }
    .text-xl { font-size: 1.25rem; }
    .text-2xl { font-size: 1.5rem; }
    .text-3xl { font-size: 1.875rem; }
    .text-4xl { font-size: 2.25rem; }

    .font-light { font-weight: 300; }
    .font-normal { font-weight: 400; }
    .font-medium { font-weight: 500; }
    .font-semibold { font-weight: 600; }
    .font-bold { font-weight: 700; }

    .text-primary { color: var(--primary); }
    .text-primary-accent { color: var(--primary-accent); }
    .text-secondary { color: var(--secondary); }
    .text-white { color: var(--white); }
    .text-gray { color: var(--gray); }

    /* 背景与边框类 */
    .bg-white { background-color: var(--white); }
    .bg-light { background-color: var(--light-bg); }
    .bg-primary { background-color: var(--primary); }
    .bg-primary-accent { background-color: var(--primary-accent); }
    .bg-gray-light { background-color: var(--gray-light); }

    .border { border: 1px solid var(--border-color); }
    .border-b { border-bottom: 1px solid var(--border-color); }
    .border-r { border-right: 1px solid var(--border-color); }
    .border-l-4 { border-left: 4px solid var(--primary-accent); }

    .rounded { border-radius: 4px; }
    .rounded-md { border-radius: 6px; }
    .rounded-lg { border-radius: 8px; }

    /* 阴影与过渡类 */
    .shadow { box-shadow: var(--shadow); }
    .shadow-hover { transition: var(--transition); }
    .shadow-hover:hover { box-shadow: var(--shadow-hover); }

    .transition { transition: var(--transition); }

    /* 顶部导航栏 */
    #top-nav {
      height: 60px;
      z-index: 50;
      background-color: var(--white);
      box-shadow: var(--shadow);
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-weight: 600;
      font-size: 1.25rem;
      color: var(--primary);
      text-decoration: none;
    }

    .nav-link {
      color: var(--text-medium);
      text-decoration: none;
      transition: var(--transition);
      font-weight: 500;
    }

    .nav-link:hover {
      color: var(--primary-accent);
    }

    .nav-link.active {
      color: var(--primary-accent);
    }

    .menu-toggle {
      background: none;
      border: none;
      font-size: 1.5rem;
      color: var(--primary);
      cursor: pointer;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0.5rem 1rem;
      border-radius: 4px;
      font-weight: 500;
      text-decoration: none;
      cursor: pointer;
      transition: var(--transition);
      border: none;
    }

    .btn-primary {
      background-color: var(--primary-accent);
      color: var(--white);
    }

    .btn-primary:hover {
      background-color: #2980b9;
    }

    /* 左侧章节导航 - 始终显示 */
    #left-sidebar {
      width: 240px;
      position: fixed;
      top: 60px;
      bottom: 0;
      background-color: var(--white);
      border-right: 1px solid var(--border-color);
      z-index: 40;
      overflow-y: auto;
      scrollbar-hide: auto;
    }

    /* 响应式调整左侧导航宽度 */
    @media (max-width: 1024px) {
      #left-sidebar {
        width: 200px;
      }
    }

    @media (max-width: 768px) {
      #left-sidebar {
        width: 160px;
      }
    }

    .chapter-title {
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--primary);
      padding-bottom: 0.5rem;
      border-bottom: 1px solid var(--border-color);
    }

    .chapter-link {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.75rem 1rem;
      color: var(--text-medium);
      text-decoration: none;
      transition: var(--transition);
      border-left: 3px solid transparent;
      font-size: 0.95rem;
    }

    .chapter-link:hover {
      background-color: var(--light-bg);
      color: var(--primary-accent);
    }

    .chapter-link.active {
      background-color: rgba(52, 152, 219, 0.1);
      color: var(--primary-accent);
      border-left-color: var(--primary-accent);
    }

    /* 主内容区 - 始终为左侧导航留出空间 */
    .main-content {
      margin-left: 240px; /* 与左侧导航宽度一致 */
      padding: 2rem;
      min-height: calc(100vh - 60px);
    }

    /* 响应式调整主内容区margin */
    @media (max-width: 1024px) {
      .main-content {
        margin-left: 200px;
        padding: 1.5rem;
      }
    }

    @media (max-width: 768px) {
      .main-content {
        margin-left: 160px;
        padding: 1rem;
      }
    }

    /* 为右侧导航留出空间 */
    @media (min-width: 1200px) {
      .main-content {
        padding-right: 260px; /* 右侧导航宽度+间距 */
      }
    }

    .article-header {
      margin-bottom: 3rem;
      text-align: center;
    }

    .article-title {
      font-size: 2.5rem;
      margin-bottom: 1rem;
      color: var(--primary);
    }

    .article-meta {
      color: var(--text-medium);
      font-size: 0.9rem;
    }

    /* Markdown内容样式 */
    .markdown-content h2 {
      font-size: 1.8rem;
      margin-top: 2.5rem;
      margin-bottom: 1.5rem;
      color: var(--primary);
      padding-bottom: 0.5rem;
      border-bottom: 1px solid var(--border-color);
    }

    .markdown-content h3 {
      font-size: 1.4rem;
      margin-top: 2rem;
      margin-bottom: 1rem;
      color: var(--primary-light);
    }

    .markdown-content p {
      margin-bottom: 1.25rem;
      line-height: 1.7;
    }

    .markdown-content ul,
    .markdown-content ol {
      margin-bottom: 1.25rem;
      padding-left: 1.5rem;
    }

    .markdown-content ul {
      list-style-type: disc;
    }

    .markdown-content ol {
      list-style-type: decimal;
    }

    .markdown-content li {
      margin-bottom: 0.5rem;
    }

    .markdown-content a {
      color: var(--primary-accent);
      text-decoration: none;
    }

    .markdown-content a:hover {
      text-decoration: underline;
    }

    .markdown-content blockquote {
      border-left: 4px solid var(--primary-accent);
      padding: 0.5rem 1rem;
      margin: 1.5rem 0;
      background-color: rgba(52, 152, 219, 0.05);
      color: var(--text-medium);
    }

/* 代码块样式 */
.markdown-content pre {
    background-color: #2d3748;
    color: #e2e8f0;
    border-radius: 0.375rem;
    padding: 1rem;
    margin-bottom: 1.25rem;
    overflow-x: auto;
    font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
    font-size: 0.875rem;
    line-height: 1.5;
}

.markdown-content code {
    background-color: #edf2f7;
    color: #2d3748;
    padding: 0.125rem 0.25rem;
    border-radius: 0.25rem;
    font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
    font-size: 0.875rem;
}

.markdown-content pre code {
    background-color: transparent;
    padding: 0;
    color: inherit;
}

    .markdown-content table {
      width: 100%;
      border-collapse: collapse;
      margin: 1.5rem 0;
    }

    .markdown-content th,
    .markdown-content td {
      padding: 0.75rem;
      text-align: left;
      border-bottom: 1px solid var(--border-color);
    }

    .markdown-content th {
      background-color: var(--light-bg);
      font-weight: 600;
    }

    /* 右侧悬浮二级标题导航 - 始终显示 */
    #right-sidebar {
      width: 240px;
      position: fixed;
      top: 80px;
      bottom: 80px;
      right: 20px;
      background-color: var(--white);
      border-radius: 8px;
      box-shadow: var(--shadow);
      padding: 1rem;
      overflow-y: auto;
      z-index: 30;
    }

    /* 小屏幕下调整右侧导航位置和大小 */
    @media (max-width: 1199px) and (min-width: 769px) {
      #right-sidebar {
        width: 200px;
        font-size: 0.9rem;
      }
    }

    @media (max-width: 768px) {
      #right-sidebar {
        width: 140px;
        right: 10px;
        padding: 0.75rem;
        font-size: 0.85rem;
      }
    }

    .toc-title {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 1rem;
      color: var(--primary);
      padding-bottom: 0.5rem;
      border-bottom: 1px solid var(--border-color);
    }

    .toc-link {
      display: block;
      padding: 0.35rem 0.5rem;
      color: var(--text-medium);
      text-decoration: none;
      font-size: 0.9rem;
      border-radius: 4px;
      transition: var(--transition);
    }

    .toc-link:hover {
      background-color: var(--light-bg);
      color: var(--primary-accent);
    }

    .toc-link.active {
      background-color: rgba(52, 152, 219, 0.1);
      color: var(--primary-accent);
      font-weight: 500;
    }

    .toc-level-2 {
      padding-left: 1rem;
      font-size: 0.85rem;
    }

    /* 移除移动端控制按钮 */
    #toc-toggle, #sidebar-toggle, #overlay {
      display: none !important;
    }
  </style>
</head>

<body>
  <!-- 顶部导航栏 -->
  <header id="top-nav" class="fixed top-0 left-0 right-0 bg-white shadow">
    <div class="container flex items-center justify-between h-full px-4">
      <!-- 左侧Logo -->
      <div class="flex items-center space-x-4">
        <a href="#" class="logo">
          <span>Sprival</span>
        </a>
      </div>

      <!-- 中间导航链接 -->
      <nav class="md:flex items-center space-x-6">
        <a href="#" class="nav-link">sprival</a>
        <a href="#" class="nav-link">blog</a>
        <a href="#" class="nav-link">about</a>
      </nav>

      <!-- 右侧功能区 -->
      <div class="flex items-center space-x-4">
      </div>
    </div>
  </header>

  <!-- 主内容区 -->
  <main class="main-content">
    <div class="container max-w-4xl">
      <article class="markdown-content bg-white rounded-lg shadow p-6 md:p-8">
          <pre><code class="language-java">class ConfigurationClassParser {
    public void parse(Set&lt;BeanDefinitionHolder&gt; configCandidates) {
        for (BeanDefinitionHolder holder : configCandidates) {
            BeanDefinition bd = holder.getBeanDefinition();
            try {
                if (bd instanceof AnnotatedBeanDefinition) {
                    // 1.1 进入这里
                    parse(((AnnotatedBeanDefinition) bd).getMetadata(), holder.getBeanName());
                } else if (bd instanceof AbstractBeanDefinition &amp;&amp; ((AbstractBeanDefinition) bd).hasBeanClass()) {
                    parse(((AbstractBeanDefinition) bd).getBeanClass(), holder.getBeanName());
                } else {
                    parse(bd.getBeanClassName(), holder.getBeanName());
                }
            } catch (BeanDefinitionStoreException ex) {
                throw ex;
            } catch (Throwable ex) {
                throw new BeanDefinitionStoreException(
                        &quot;Failed to parse configuration class [&quot; + bd.getBeanClassName() + &quot;]&quot;, ex);
            }
        }

        // 2.1 进这里
        this.deferredImportSelectorHandler.process();
    }

    protected final void parse(@Nullable String className, String beanName) throws IOException {
        Assert.notNull(className, &quot;No bean class name for configuration class bean definition&quot;);
        MetadataReader reader = this.metadataReaderFactory.getMetadataReader(className);
        processConfigurationClass(new ConfigurationClass(reader, beanName), DEFAULT_EXCLUSION_FILTER);
    }

    protected final void parse(Class&lt;?&gt; clazz, String beanName) throws IOException {
        processConfigurationClass(new ConfigurationClass(clazz, beanName), DEFAULT_EXCLUSION_FILTER);
    }


    protected final void parse(AnnotationMetadata metadata, String beanName) throws IOException {
        // 1.2 进入这里
        processConfigurationClass(new ConfigurationClass(metadata, beanName), DEFAULT_EXCLUSION_FILTER);
    }

    protected void processConfigurationClass(ConfigurationClass configClass, Predicate&lt;String&gt; filter) throws IOException {
        if (this.conditionEvaluator.shouldSkip(configClass.getMetadata(), ConfigurationPhase.PARSE_CONFIGURATION)) {
            return;
        }

        ConfigurationClass existingClass = this.configurationClasses.get(configClass);
        if (existingClass != null) {
            if (configClass.isImported()) {
                if (existingClass.isImported()) {
                    existingClass.mergeImportedBy(configClass);
                }
                // Otherwise ignore new imported config class; existing non-imported class overrides it.
                return;
            }
            else {
                // Explicit bean definition found, probably replacing an import.
                // Let's remove the old one and go with the new one.
                this.configurationClasses.remove(configClass);
                this.knownSuperclasses.values().removeIf(configClass::equals);
            }
        }

        // Recursively process the configuration class and its superclass hierarchy.
        SourceClass sourceClass = asSourceClass(configClass, filter);
        do {
            // 1.3 进这里
            sourceClass = doProcessConfigurationClass(configClass, sourceClass, filter);
        }
        while (sourceClass != null);

        this.configurationClasses.put(configClass, configClass);
    }


    @Nullable
    protected final SourceClass doProcessConfigurationClass(
            ConfigurationClass configClass, SourceClass sourceClass, Predicate&lt;String&gt; filter)
            throws IOException {

        if (configClass.getMetadata().isAnnotated(Component.class.getName())) {
            // Recursively process any member (nested) classes first
            processMemberClasses(configClass, sourceClass, filter);
        }

        // Process any @PropertySource annotations
        // 处理PropertySource注解，导入配置文件？
        for (AnnotationAttributes propertySource : AnnotationConfigUtils.attributesForRepeatable(
                sourceClass.getMetadata(), PropertySources.class,
                org.springframework.context.annotation.PropertySource.class)) {
            if (this.environment instanceof ConfigurableEnvironment) {
                processPropertySource(propertySource);
            } else {
                logger.info(&quot;Ignoring @PropertySource annotation on [&quot; + sourceClass.getMetadata().getClassName() +
                        &quot;]. Reason: Environment must implement ConfigurableEnvironment&quot;);
            }
        }

        // 处理 @Component + @ComponentScan 注册为bean
        // Process any @ComponentScan annotations
        Set&lt;AnnotationAttributes&gt; componentScans = AnnotationConfigUtils.attributesForRepeatable(
                sourceClass.getMetadata(), ComponentScans.class, ComponentScan.class);
        if (!componentScans.isEmpty() &amp;&amp;
                !this.conditionEvaluator.shouldSkip(sourceClass.getMetadata(), ConfigurationPhase.REGISTER_BEAN)) {
            for (AnnotationAttributes componentScan : componentScans) {
                // The config class is annotated with @ComponentScan -&gt; perform the scan immediately
                // 扫描默认SpringApplication的BasePackage路径下所有注解了@Conpoment的类
                // ClassPathBeanDefinitionScanner 扫描注册为bean
                Set&lt;BeanDefinitionHolder&gt; scannedBeanDefinitions =
                        this.componentScanParser.parse(componentScan, sourceClass.getMetadata().getClassName());
                // Check the set of scanned definitions for any further config classes and parse recursively if needed
                for (BeanDefinitionHolder holder : scannedBeanDefinitions) {
                    BeanDefinition bdCand = holder.getBeanDefinition().getOriginatingBeanDefinition();
                    if (bdCand == null) {
                        bdCand = holder.getBeanDefinition();
                    }
                    if (ConfigurationClassUtils.checkConfigurationClassCandidate(bdCand, this.metadataReaderFactory)) {
                        // 属于@Configuration注解的类，递归执行
                        parse(bdCand.getBeanClassName(), holder.getBeanName());
                    }
                }
            }
        }

        // Process any @Import annotations
        // 处理包含 @Import  ImportSelector接口 ImportBeanDefinitionRegistrar接口
        processImports(configClass, sourceClass, getImports(sourceClass), filter, true);

        // Process any @ImportResource annotations
        AnnotationAttributes importResource =
                AnnotationConfigUtils.attributesFor(sourceClass.getMetadata(), ImportResource.class);
        if (importResource != null) {
            String[] resources = importResource.getStringArray(&quot;locations&quot;);
            Class&lt;? extends BeanDefinitionReader&gt; readerClass = importResource.getClass(&quot;reader&quot;);
            for (String resource : resources) {
                String resolvedResource = this.environment.resolveRequiredPlaceholders(resource);
                configClass.addImportedResource(resolvedResource, readerClass);
            }
        }

        // Process individual @Bean methods
        // 
        Set&lt;MethodMetadata&gt; beanMethods = retrieveBeanMethodMetadata(sourceClass);
        for (MethodMetadata methodMetadata : beanMethods) {
            configClass.addBeanMethod(new BeanMethod(methodMetadata, configClass));
        }

        // Process default methods on interfaces
        processInterfaces(configClass, sourceClass);

        // Process superclass, if any
        if (sourceClass.getMetadata().hasSuperClass()) {
            String superclass = sourceClass.getMetadata().getSuperClassName();
            if (superclass != null &amp;&amp; !superclass.startsWith(&quot;java&quot;) &amp;&amp;
                    !this.knownSuperclasses.containsKey(superclass)) {
                this.knownSuperclasses.put(superclass, configClass);
                // Superclass found, return its annotation metadata and recurse
                return sourceClass.getSuperClass();
            }
        }

        // No superclass -&gt; processing is complete
        return null;
    }

    private void processImports(ConfigurationClass configClass, SourceClass currentSourceClass,
                                Collection&lt;SourceClass&gt; importCandidates, Predicate&lt;String&gt; exclusionFilter,
                                boolean checkForCircularImports) {

        if (importCandidates.isEmpty()) {
            return;
        }

        if (checkForCircularImports &amp;&amp; isChainedImportOnStack(configClass)) {
            this.problemReporter.error(new CircularImportProblem(configClass, this.importStack));
        }
        else {
            this.importStack.push(configClass);
            try {
                for (SourceClass candidate : importCandidates) {
                    if (candidate.isAssignable(ImportSelector.class)) {
                        // Candidate class is an ImportSelector -&gt; delegate to it to determine imports
                        Class&lt;?&gt; candidateClass = candidate.loadClass();
                        ImportSelector selector = ParserStrategyUtils.instantiateClass(candidateClass, ImportSelector.class,
                                this.environment, this.resourceLoader, this.registry);
                        Predicate&lt;String&gt; selectorFilter = selector.getExclusionFilter();
                        if (selectorFilter != null) {
                            exclusionFilter = exclusionFilter.or(selectorFilter);
                        }
                        if (selector instanceof DeferredImportSelector) {
                            this.deferredImportSelectorHandler.handle(configClass, (DeferredImportSelector) selector);
                        }
                        else {
                            String[] importClassNames = selector.selectImports(currentSourceClass.getMetadata());
                            Collection&lt;SourceClass&gt; importSourceClasses = asSourceClasses(importClassNames, exclusionFilter);
                            processImports(configClass, currentSourceClass, importSourceClasses, exclusionFilter, false);
                        }
                    }
                    else if (candidate.isAssignable(ImportBeanDefinitionRegistrar.class)) {
                        // Candidate class is an ImportBeanDefinitionRegistrar -&gt;
                        // delegate to it to register additional bean definitions
                        Class&lt;?&gt; candidateClass = candidate.loadClass();
                        ImportBeanDefinitionRegistrar registrar =
                                ParserStrategyUtils.instantiateClass(candidateClass, ImportBeanDefinitionRegistrar.class,
                                        this.environment, this.resourceLoader, this.registry);
                        configClass.addImportBeanDefinitionRegistrar(registrar, currentSourceClass.getMetadata());
                    }
                    else {
                        // Candidate class not an ImportSelector or ImportBeanDefinitionRegistrar -&gt;
                        // process it as an @Configuration class
                        this.importStack.registerImport(
                                currentSourceClass.getMetadata(), candidate.getMetadata().getClassName());
                        processConfigurationClass(candidate.asConfigClass(configClass), exclusionFilter);
                    }
                }
            }
            catch (BeanDefinitionStoreException ex) {
                throw ex;
            }
            catch (Throwable ex) {
                throw new BeanDefinitionStoreException(
                        &quot;Failed to process import candidates for configuration class [&quot; +
                                configClass.getMetadata().getClassName() + &quot;]&quot;, ex);
            }
            finally {
                this.importStack.pop();
            }
        }
    }

    private class DeferredImportSelectorHandler {

        @Nullable
        private List&lt;DeferredImportSelectorHolder&gt; deferredImportSelectors = new ArrayList&lt;&gt;();

        /**
         * Handle the specified {@link DeferredImportSelector}. If deferred import
         * selectors are being collected, this registers this instance to the list. If
         * they are being processed, the {@link DeferredImportSelector} is also processed
         * immediately according to its {@link DeferredImportSelector.Group}.
         * @param configClass the source configuration class
         * @param importSelector the selector to handle
         */
        public void handle(ConfigurationClass configClass, DeferredImportSelector importSelector) {
            DeferredImportSelectorHolder holder = new DeferredImportSelectorHolder(configClass, importSelector);
            if (this.deferredImportSelectors == null) {
                DeferredImportSelectorGroupingHandler handler = new DeferredImportSelectorGroupingHandler();
                handler.register(holder);
                handler.processGroupImports();
            } else {
                this.deferredImportSelectors.add(holder);
            }
        }

        public void process() {
            // 2.2 进这里
            List&lt;DeferredImportSelectorHolder&gt; deferredImports = this.deferredImportSelectors;
            this.deferredImportSelectors = null;
            try {
                if (deferredImports != null) {
                    DeferredImportSelectorGroupingHandler handler = new DeferredImportSelectorGroupingHandler();
                    deferredImports.sort(DEFERRED_IMPORT_COMPARATOR);
                    deferredImports.forEach(handler::register);
                    handler.processGroupImports();
                }
            } finally {
                this.deferredImportSelectors = new ArrayList&lt;&gt;();
            }
        }
    }


}
</code></pre>
<p>通过 ClassPathBeanDefinitionScanner执行</p>
<pre><code class="language-java">public class ClassPathBeanDefinitionScanner extends ClassPathScanningCandidateComponentProvider {
    protected Set&lt;BeanDefinitionHolder&gt; doScan(String... basePackages) {
        Assert.notEmpty(basePackages, &quot;At least one base package must be specified&quot;);
        Set&lt;BeanDefinitionHolder&gt; beanDefinitions = new LinkedHashSet&lt;&gt;();
        for (String basePackage : basePackages) {
            Set&lt;BeanDefinition&gt; candidates = findCandidateComponents(basePackage);
            for (BeanDefinition candidate : candidates) {
                ScopeMetadata scopeMetadata = this.scopeMetadataResolver.resolveScopeMetadata(candidate);
                candidate.setScope(scopeMetadata.getScopeName());
                String beanName = this.beanNameGenerator.generateBeanName(candidate, this.registry);
                if (candidate instanceof AbstractBeanDefinition) {
                    postProcessBeanDefinition((AbstractBeanDefinition) candidate, beanName);
                }
                if (candidate instanceof AnnotatedBeanDefinition) {
                    AnnotationConfigUtils.processCommonDefinitionAnnotations((AnnotatedBeanDefinition) candidate);
                }
                if (checkCandidate(beanName, candidate)) {
                    BeanDefinitionHolder definitionHolder = new BeanDefinitionHolder(candidate, beanName);
                    definitionHolder =
                            AnnotationConfigUtils.applyScopedProxyMode(scopeMetadata, definitionHolder, this.registry);
                    beanDefinitions.add(definitionHolder);
                    registerBeanDefinition(definitionHolder, this.registry);
                }
            }
        }
        return beanDefinitions;
    }
}
</code></pre>
<p>调用栈</p>
<pre><code class="language-text">doScan:273, ClassPathBeanDefinitionScanner (org.springframework.context.annotation)
parse:132, ComponentScanAnnotationParser (org.springframework.context.annotation)
doProcessConfigurationClass:296, ConfigurationClassParser (org.springframework.context.annotation)
processConfigurationClass:250, ConfigurationClassParser (org.springframework.context.annotation)
parse:207, ConfigurationClassParser (org.springframework.context.annotation)
parse:175, ConfigurationClassParser (org.springframework.context.annotation)
processConfigBeanDefinitions:320, ConfigurationClassPostProcessor (org.springframework.context.annotation)
postProcessBeanDefinitionRegistry:237, ConfigurationClassPostProcessor (org.springframework.context.annotation)
invokeBeanDefinitionRegistryPostProcessors:280, PostProcessorRegistrationDelegate (org.springframework.context.support)
invokeBeanFactoryPostProcessors:96, PostProcessorRegistrationDelegate (org.springframework.context.support)
invokeBeanFactoryPostProcessors:707, AbstractApplicationContext (org.springframework.context.support)
refresh:533, AbstractApplicationContext (org.springframework.context.support)
refresh:143, ServletWebServerApplicationContext (org.springframework.boot.web.servlet.context)
refresh:755, SpringApplication (org.springframework.boot)
refresh:747, SpringApplication (org.springframework.boot)
refreshContext:402, SpringApplication (org.springframework.boot)
run:312, SpringApplication (org.springframework.boot)
main:35, StartApplication (com.zuzuche.widget.start)
</code></pre>
<p>parse @Configuration(sprivalApplication) -&gt;
          scan =&gt;  @Component
                  =&gt; parse @Configuration</p>
<p>doProcessConfigurationClass：
    processPropertySource
    componentScanParser.parse
    processImports
    @Bean</p>
      </article>
    </div>
  </main>



  <script>
    // 元素获取
    const chapterLinks = document.querySelectorAll('.chapter-link');
    const tocLinks = document.querySelectorAll('.toc-link');
    const sections = document.querySelectorAll('section, h3[id]');

    // 滚动监听，高亮当前章节和目录项
    window.addEventListener('scroll', () => {
      let current = '';

      // 找到当前可见的最高章节
      sections.forEach(section => {
        const sectionTop = section.offsetTop;
        const sectionHeight = section.clientHeight;

        if (window.scrollY >= (sectionTop - 150)) {
          current = section.getAttribute('id');
        }
      });

      // 更新左侧章节导航高亮
      chapterLinks.forEach(link => {
        link.classList.remove('active');
        if (link.getAttribute('href').substring(1) === current ||
            current.startsWith(link.getAttribute('href').substring(1) + '-')) {
          link.classList.add('active');
        }
      });

      // 更新右侧目录导航高亮
      tocLinks.forEach(link => {
        link.classList.remove('active');
        if (link.getAttribute('href').substring(1) === current) {
          link.classList.add('active');
        }
      });
    });
  </script>
</body>
</html>
