<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog</title>

    <style>
        /* 基础样式与变量定义 */
        :root {
            --primary: #2c3e50;
            --primary-light: #34495e;
            --primary-accent: #3498db;
            --secondary: #7f8c8d;
            --light-bg: #f5f7fa;
            --white: #ffffff;
            --gray-light: #ecf0f1;
            --gray: #bdc3c7;
            --text-dark: #2c3e50;
            --text-medium: #7f8c8d;
            --text-light: #95a5a6;
            --border-color: #e1e4e8;
            --shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
            --shadow-hover: 0 4px 15px rgba(0, 0, 0, 0.12);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Helvetica Neue", Arial, sans-serif;
            color: var(--text-dark);
            background-color: var(--light-bg);
            line-height: 1.6;
            overflow-x: hidden;
            padding-top: 60px; /* 为顶部导航栏预留空间 */
        }

        /* 布局基础类 */
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        .flex {
            display: flex;
        }

        .items-center {
            align-items: center;
        }

        .justify-between {
            justify-content: space-between;
        }

        .fixed {
            position: fixed;
        }

        .relative {
            position: relative;
        }

        .absolute {
            position: absolute;
        }

        .top-0 {
            top: 0;
        }

        .left-0 {
            left: 0;
        }

        .right-0 {
            right: 0;
        }

        .bottom-0 {
            bottom: 0;
        }

        .w-full {
            width: 100%;
        }

        .h-full {
            height: 100%;
        }

        .overflow-hidden {
            overflow: hidden;
        }

        .overflow-y-auto {
            overflow-y: auto;
        }

        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }

        .text-center {
            text-align: center;
        }

        .hidden {
            display: none !important;
        }

        .block {
            display: block;
        }

        /* 间距类 */
        .m-1 {
            margin: 0.25rem;
        }

        .m-2 {
            margin: 0.5rem;
        }

        .m-4 {
            margin: 1rem;
        }

        .m-6 {
            margin: 1.5rem;
        }

        .m-8 {
            margin: 2rem;
        }

        .mt-1 {
            margin-top: 0.25rem;
        }

        .mt-2 {
            margin-top: 0.5rem;
        }

        .mt-4 {
            margin-top: 1rem;
        }

        .mt-6 {
            margin-top: 1.5rem;
        }

        .mt-8 {
            margin-top: 2rem;
        }

        .mt-16 {
            margin-top: 4rem;
        }

        .mb-1 {
            margin-bottom: 0.25rem;
        }

        .mb-2 {
            margin-bottom: 0.5rem;
        }

        .mb-4 {
            margin-bottom: 1rem;
        }

        .mb-6 {
            margin-bottom: 1.5rem;
        }

        .mb-8 {
            margin-bottom: 2rem;
        }

        .mb-12 {
            margin-bottom: 3rem;
        }

        .ml-4 {
            margin-left: 1rem;
        }

        .mr-4 {
            margin-right: 1rem;
        }

        .p-1 {
            padding: 0.25rem;
        }

        .p-2 {
            padding: 0.5rem;
        }

        .p-4 {
            padding: 1rem;
        }

        .p-6 {
            padding: 1.5rem;
        }

        .p-8 {
            padding: 2rem;
        }

        .py-2 {
            padding-top: 0.5rem;
            padding-bottom: 0.5rem;
        }

        .py-3 {
            padding-top: 0.75rem;
            padding-bottom: 0.75rem;
        }

        .py-4 {
            padding-top: 1rem;
            padding-bottom: 1rem;
        }

        .py-6 {
            padding-top: 1.5rem;
            padding-bottom: 1.5rem;
        }

        .py-8 {
            padding-top: 2rem;
            padding-bottom: 2rem;
        }

        .px-2 {
            padding-left: 0.5rem;
            padding-right: 0.5rem;
        }

        .px-3 {
            padding-left: 0.75rem;
            padding-right: 0.75rem;
        }

        .px-4 {
            padding-left: 1rem;
            padding-right: 1rem;
        }

        .px-6 {
            padding-left: 1.5rem;
            padding-right: 1.5rem;
        }

        .space-y-1 > * + * {
            margin-top: 0.25rem;
        }

        .space-y-2 > * + * {
            margin-top: 0.5rem;
        }

        .space-y-4 > * + * {
            margin-top: 1rem;
        }

        .space-y-6 > * + * {
            margin-top: 1.5rem;
        }

        .space-x-2 > * + * {
            margin-left: 0.5rem;
        }

        .space-x-4 > * + * {
            margin-left: 1rem;
        }

        .space-x-6 > * + * {
            margin-left: 1.5rem;
        }

        /* 文本样式类 */
        .text-xs {
            font-size: 0.75rem;
        }

        .text-sm {
            font-size: 0.875rem;
        }

        .text-base {
            font-size: 1rem;
        }

        .text-lg {
            font-size: 1.125rem;
        }

        .text-xl {
            font-size: 1.25rem;
        }

        .text-2xl {
            font-size: 1.5rem;
        }

        .text-3xl {
            font-size: 1.875rem;
        }

        .text-4xl {
            font-size: 2.25rem;
        }

        .font-light {
            font-weight: 300;
        }

        .font-normal {
            font-weight: 400;
        }

        .font-medium {
            font-weight: 500;
        }

        .font-semibold {
            font-weight: 600;
        }

        .font-bold {
            font-weight: 700;
        }

        .text-primary {
            color: var(--primary);
        }

        .text-primary-accent {
            color: var(--primary-accent);
        }

        .text-secondary {
            color: var(--secondary);
        }

        .text-white {
            color: var(--white);
        }

        .text-gray {
            color: var(--gray);
        }

        /* 背景与边框类 */
        .bg-white {
            background-color: var(--white);
        }

        .bg-light {
            background-color: var(--light-bg);
        }

        .bg-primary {
            background-color: var(--primary);
        }

        .bg-primary-accent {
            background-color: var(--primary-accent);
        }

        .bg-gray-light {
            background-color: var(--gray-light);
        }

        .border {
            border: 1px solid var(--border-color);
        }

        .border-b {
            border-bottom: 1px solid var(--border-color);
        }

        .border-r {
            border-right: 1px solid var(--border-color);
        }

        .border-l-4 {
            border-left: 4px solid var(--primary-accent);
        }

        .rounded {
            border-radius: 4px;
        }

        .rounded-md {
            border-radius: 6px;
        }

        .rounded-lg {
            border-radius: 8px;
        }

        /* 阴影与过渡类 */
        .shadow {
            box-shadow: var(--shadow);
        }

        .shadow-hover {
            transition: var(--transition);
        }

        .shadow-hover:hover {
            box-shadow: var(--shadow-hover);
        }

        .transition {
            transition: var(--transition);
        }

        /* 顶部导航栏 */
        #top-nav {
            height: 60px;
            z-index: 50;
            background-color: var(--white);
            box-shadow: var(--shadow);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
            font-size: 1.25rem;
            color: var(--primary);
            text-decoration: none;
        }

        .nav-link {
            color: var(--text-medium);
            text-decoration: none;
            transition: var(--transition);
            font-weight: 500;
        }

        .nav-link:hover {
            color: var(--primary-accent);
        }

        .nav-link.active {
            color: var(--primary-accent);
        }

        .menu-toggle {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--primary);
            cursor: pointer;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            font-weight: 500;
            text-decoration: none;
            cursor: pointer;
            transition: var(--transition);
            border: none;
        }

        .btn-primary {
            background-color: var(--primary-accent);
            color: var(--white);
        }

        .btn-primary:hover {
            background-color: #2980b9;
        }

        /* 左侧章节导航 - 始终显示 */
        #left-sidebar {
            width: 240px;
            position: fixed;
            top: 60px;
            bottom: 0;
            background-color: var(--white);
            border-right: 1px solid var(--border-color);
            z-index: 40;
            overflow-y: auto;
            scrollbar-hide: auto;
        }

        /* 响应式调整左侧导航宽度 */
        @media (max-width: 1024px) {
            #left-sidebar {
                width: 200px;
            }
        }

        @media (max-width: 768px) {
            #left-sidebar {
                width: 160px;
            }
        }

        .chapter-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--primary);
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .chapter-link {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1rem;
            color: var(--text-medium);
            text-decoration: none;
            transition: var(--transition);
            border-left: 3px solid transparent;
            font-size: 0.95rem;
        }

        .chapter-link:hover {
            background-color: var(--light-bg);
            color: var(--primary-accent);
        }

        .chapter-link.active {
            background-color: rgba(52, 152, 219, 0.1);
            color: var(--primary-accent);
            border-left-color: var(--primary-accent);
        }

        /* 主内容区 - 始终为左侧导航留出空间 */
        .main-content {
            margin-left: 240px; /* 与左侧导航宽度一致 */
            padding: 2rem;
            min-height: calc(100vh - 60px);
        }

        /* 响应式调整主内容区margin */
        @media (max-width: 1024px) {
            .main-content {
                margin-left: 200px;
                padding: 1.5rem;
            }
        }

        @media (max-width: 768px) {
            .main-content {
                margin-left: 160px;
                padding: 1rem;
            }
        }

        /* 为右侧导航留出空间 */
        @media (min-width: 1200px) {
            .main-content {
                padding-right: 260px; /* 右侧导航宽度+间距 */
            }
        }

        .article-header {
            margin-bottom: 3rem;
            text-align: center;
        }

        .article-title {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: var(--primary);
        }

        .article-meta {
            color: var(--text-medium);
            font-size: 0.9rem;
        }

        /* Markdown内容样式 */
        .markdown-content h2 {
            font-size: 1.8rem;
            margin-top: 2.5rem;
            margin-bottom: 1.5rem;
            color: var(--primary);
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .markdown-content h3 {
            font-size: 1.4rem;
            margin-top: 2rem;
            margin-bottom: 1rem;
            color: var(--primary-light);
        }

        .markdown-content p {
            margin-bottom: 1.25rem;
            line-height: 1.7;
        }

        .markdown-content ul,
        .markdown-content ol {
            margin-bottom: 1.25rem;
            padding-left: 1.5rem;
        }

        .markdown-content ul {
            list-style-type: disc;
        }

        .markdown-content ol {
            list-style-type: decimal;
        }

        .markdown-content li {
            margin-bottom: 0.5rem;
        }

        .markdown-content a {
            color: var(--primary-accent);
            text-decoration: none;
        }

        .markdown-content a:hover {
            text-decoration: underline;
        }

        .markdown-content blockquote {
            border-left: 4px solid var(--primary-accent);
            padding: 0.5rem 1rem;
            margin: 1.5rem 0;
            background-color: rgba(52, 152, 219, 0.05);
            color: var(--text-medium);
        }

        /* 代码块样式 */
        .markdown-content pre {
            background-color: #2d3748;
            color: #e2e8f0;
            border-radius: 0.375rem;
            padding: 1rem;
            margin-bottom: 1.25rem;
            overflow-x: auto;
            font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
            font-size: 0.875rem;
            line-height: 1.5;
        }

        .markdown-content code {
            background-color: #edf2f7;
            color: #2d3748;
            padding: 0.125rem 0.25rem;
            border-radius: 0.25rem;
            font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
            font-size: 0.875rem;
        }

        .markdown-content pre code {
            background-color: transparent;
            padding: 0;
            color: inherit;
        }

        .markdown-content table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
        }

        .markdown-content th,
        .markdown-content td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .markdown-content th {
            background-color: var(--light-bg);
            font-weight: 600;
        }

        /* 右侧悬浮二级标题导航 - 始终显示 */
        #right-sidebar {
            width: 240px;
            position: fixed;
            top: 80px;
            bottom: 80px;
            right: 20px;
            background-color: var(--white);
            border-radius: 8px;
            box-shadow: var(--shadow);
            padding: 1rem;
            overflow-y: auto;
            z-index: 30;
        }

        /* 小屏幕下调整右侧导航位置和大小 */
        @media (max-width: 1199px) and (min-width: 769px) {
            #right-sidebar {
                width: 200px;
                font-size: 0.9rem;
            }
        }

        @media (max-width: 768px) {
            #right-sidebar {
                width: 140px;
                right: 10px;
                padding: 0.75rem;
                font-size: 0.85rem;
            }
        }

        .toc-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--primary);
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .toc-link {
            display: block;
            padding: 0.35rem 0.5rem;
            color: var(--text-medium);
            text-decoration: none;
            font-size: 0.9rem;
            border-radius: 4px;
            transition: var(--transition);
        }

        .toc-link:hover {
            background-color: var(--light-bg);
            color: var(--primary-accent);
        }

        .toc-link.active {
            background-color: rgba(52, 152, 219, 0.1);
            color: var(--primary-accent);
            font-weight: 500;
        }

        .toc-level-2 {
            padding-left: 1rem;
            font-size: 0.85rem;
        }

        /* 移除移动端控制按钮 */
        #toc-toggle, #sidebar-toggle, #overlay {
            display: none !important;
        }

        img {
            max-width: 100%; /* 最大宽度不超过父容器 */
            height: auto; /* 高度自动计算，保持原始比例 */
            display: block; /* 移除图片底部默认空白 */
            margin: 0 auto; /* 可选：让图片居中显示 */
        }

     .back-link {
      /* 基础布局 */
      display: inline-flex;
      align-items: center;
      gap: 6px; /* 箭头与文字间距 */
      padding: 6px 0; /* 仅上下内边距，不添加左右额外空间 */
      color: #333;
      font-size: 14px;
      text-decoration: none; /* 去掉默认下划线 */
      transition: color 0.2s;
      cursor: pointer; /* 鼠标悬停显示手型，提示可点击 */
      margin-bottom: 10px;
    }

    /* 左箭头样式 */
    .back-link::before {
      content: '';
      width: 0;
      height: 0;
      border-top: 5px solid transparent;
      border-bottom: 5px solid transparent;
      border-right: 5px solid #333; /* 箭头颜色默认与文字一致 */
      transition: border-color 0.2s;
    }

    /* hover效果：颜色加深+下划线 */
    .back-link:hover {
      color: #0066cc;
    }

    .back-link:hover::before {
      border-right-color: #0066cc; /* 箭头颜色随文字同步变化 */
    }
    </style>
</head>

<body>
<!-- 顶部导航栏 -->
<header id="top-nav" class="fixed top-0 left-0 right-0 bg-white shadow">
    <div class="container flex items-center justify-between h-full px-4">
        <!-- 左侧Logo -->
        <div class="flex items-center space-x-4">
            <a href="#" class="logo">
                <span>Blog</span>
            </a>
        </div>

        <!-- 中间导航链接 -->
        <nav class="md:flex items-center space-x-6">

        </nav>

        <!-- 右侧功能区 -->
        <div class="flex items-center space-x-4">
            <a href="/sprdoc/index.html" class="nav-link active">Sprival</a>
        </div>
    </div>
</header>

<!-- 主内容区 -->
<main class="main-content">

    <div class="container max-w-4xl">


        <article class="markdown-content bg-white rounded-lg shadow p-6 md:p-8">
            <div>
                <a href="/sprdoc/blog_index.html" class="back-link">返回列表</a>
            </div>

            <h2>简述</h2>
<p>// 先注册BeanDefinition
执行BeanDefinitionRegistryPostProcessor.postProcessBeanDefinitionRegistry</p>
<p>// 
执行BeanFactoryPostProcessor.postProcessBeanFactory</p>
<h2>源码分析</h2>
<pre><code class="language-java">final class PostProcessorRegistrationDelegate {


    public static void invokeBeanFactoryPostProcessors(
          ConfigurableListableBeanFactory beanFactory, List&lt;BeanFactoryPostProcessor&gt; beanFactoryPostProcessors) {

       // Invoke BeanDefinitionRegistryPostProcessors first, if any.
       Set&lt;String&gt; processedBeans = new HashSet&lt;&gt;();

       if (beanFactory instanceof BeanDefinitionRegistry) {

           // 第一步：先执行外部传入的 beanFactory后置处理器BeanDefinitionRegistryPostProcessor的postProcessBeanDefinitionRegistry方法
          BeanDefinitionRegistry registry = (BeanDefinitionRegistry) beanFactory;
          List&lt;BeanFactoryPostProcessor&gt; regularPostProcessors = new ArrayList&lt;&gt;();
          List&lt;BeanDefinitionRegistryPostProcessor&gt; registryProcessors = new ArrayList&lt;&gt;();

          for (BeanFactoryPostProcessor postProcessor : beanFactoryPostProcessors) {
             if (postProcessor instanceof BeanDefinitionRegistryPostProcessor) {
                BeanDefinitionRegistryPostProcessor registryProcessor =
                      (BeanDefinitionRegistryPostProcessor) postProcessor;

                registryProcessor.postProcessBeanDefinitionRegistry(registry);
                registryProcessors.add(registryProcessor);
             }
             else {
                regularPostProcessors.add(postProcessor);
             }
          }

          // Do not initialize FactoryBeans here: We need to leave all regular beans
          // uninitialized to let the bean factory post-processors apply to them!
          // Separate between BeanDefinitionRegistryPostProcessors that implement
          // PriorityOrdered, Ordered, and the rest.
          List&lt;BeanDefinitionRegistryPostProcessor&gt; currentRegistryProcessors = new ArrayList&lt;&gt;();

          // 第二步：执行继承PriorityOrdered接口的beanFactory后置处理器BeanDefinitionRegistryPostProcessor的postProcessBeanDefinitionRegistry方法
          // 其实就是执行优先级高的，实际上是ConfigurationClassPostProcessor这个处理
          // ConfigurationClassPostProcessor就是注解类的解析，生成和注册BeanDefinition
          // 早期是xml方式，对于新增的注解方式，解决方案是增加 BeanDefinitionRegistryPostProcessor 这个扩展点
          String[] postProcessorNames =
                beanFactory.getBeanNamesForType(BeanDefinitionRegistryPostProcessor.class, true, false);
          for (String ppName : postProcessorNames) {
             if (beanFactory.isTypeMatch(ppName, PriorityOrdered.class)) {
                currentRegistryProcessors.add(beanFactory.getBean(ppName, BeanDefinitionRegistryPostProcessor.class));
                processedBeans.add(ppName);
             }
          }
          sortPostProcessors(currentRegistryProcessors, beanFactory);
          registryProcessors.addAll(currentRegistryProcessors);

          // currentRegistryProcessors =&gt; ConfigurationClassPostProcessor
          invokeBeanDefinitionRegistryPostProcessors(currentRegistryProcessors, registry);

          currentRegistryProcessors.clear();

          // 第三步：执行继承Ordered接口的beanFactory后置处理器BeanDefinitionRegistryPostProcessor的postProcessBeanDefinitionRegistry方法
          // 按顺序执行，默认情况下，并没有这种后置处理器
          postProcessorNames = beanFactory.getBeanNamesForType(BeanDefinitionRegistryPostProcessor.class, true, false);
          for (String ppName : postProcessorNames) {
             if (!processedBeans.contains(ppName) &amp;&amp; beanFactory.isTypeMatch(ppName, Ordered.class)) {
                currentRegistryProcessors.add(beanFactory.getBean(ppName, BeanDefinitionRegistryPostProcessor.class));
                processedBeans.add(ppName);
             }
          }
          sortPostProcessors(currentRegistryProcessors, beanFactory);
          registryProcessors.addAll(currentRegistryProcessors);

           // currentRegistryProcessors =&gt; empty
          invokeBeanDefinitionRegistryPostProcessors(currentRegistryProcessors, registry);
          currentRegistryProcessors.clear();

          // 第四步：执行所有的beanFactory后置处理器BeanDefinitionRegistryPostProcessor的postProcessBeanDefinitionRegistry方法
          // 这里的while循环是考虑到postProcessBeanDefinitionRegistry方法里可能产生新的beanFactory后置处理器，要全部执行到
          // 使用mybatis的话，就会有MapperScannerConfigurer，扫描xxxMapper为BeanDefinition 
          boolean reiterate = true;
          while (reiterate) {
             reiterate = false;
             postProcessorNames = beanFactory.getBeanNamesForType(BeanDefinitionRegistryPostProcessor.class, true, false);
             for (String ppName : postProcessorNames) {
                if (!processedBeans.contains(ppName)) {
                   currentRegistryProcessors.add(beanFactory.getBean(ppName, BeanDefinitionRegistryPostProcessor.class));
                   processedBeans.add(ppName);
                   reiterate = true;
                }
             }
             sortPostProcessors(currentRegistryProcessors, beanFactory);
             registryProcessors.addAll(currentRegistryProcessors);

             // currentRegistryProcessors =&gt; MapperScannerConfigurer
             invokeBeanDefinitionRegistryPostProcessors(currentRegistryProcessors, registry);
             currentRegistryProcessors.clear();
          }

          // BeanDefinitionRegistryPostProcessor继承BeanFactoryPostProcessor接口
           // 这里是执行一下BeanDefinitionRegistryPostProcessor类型后置处理的postProcessBeanFactory方法
           //registryProcessors =&gt; 
           // CachingMetadataReaderFactoryPostProcessor
           // ConfigurationWarningsPostProcessor
           // ConfigurationClassPostProcessor
           // MapperScannerConfigurer
          invokeBeanFactoryPostProcessors(registryProcessors, beanFactory);

          // regularPostProcessors =&gt;
           //PropertySourceOrderingPostProcessor
          invokeBeanFactoryPostProcessors(regularPostProcessors, beanFactory);
       }

       else {
          // Invoke factory processors registered with the context instance.
          invokeBeanFactoryPostProcessors(beanFactoryPostProcessors, beanFactory);
       }

       // 按照 PriorityOrdered -&gt; Ordered -&gt; 普通的顺序执行beanFactory后置处理器BeanFactoryPostProcessor的postProcessBeanFactory方法
       // Do not initialize FactoryBeans here: We need to leave all regular beans
       // uninitialized to let the bean factory post-processors apply to them!
       String[] postProcessorNames =
             beanFactory.getBeanNamesForType(BeanFactoryPostProcessor.class, true, false);

       // Separate between BeanFactoryPostProcessors that implement PriorityOrdered,
       // Ordered, and the rest.
       List&lt;BeanFactoryPostProcessor&gt; priorityOrderedPostProcessors = new ArrayList&lt;&gt;();
       List&lt;String&gt; orderedPostProcessorNames = new ArrayList&lt;&gt;();
       List&lt;String&gt; nonOrderedPostProcessorNames = new ArrayList&lt;&gt;();
       for (String ppName : postProcessorNames) {
          if (processedBeans.contains(ppName)) {
             // skip - already processed in first phase above
          }
          else if (beanFactory.isTypeMatch(ppName, PriorityOrdered.class)) {
             priorityOrderedPostProcessors.add(beanFactory.getBean(ppName, BeanFactoryPostProcessor.class));
          }
          else if (beanFactory.isTypeMatch(ppName, Ordered.class)) {
             orderedPostProcessorNames.add(ppName);
          }
          else {
             nonOrderedPostProcessorNames.add(ppName);
          }
       }

       // First, invoke the BeanFactoryPostProcessors that implement PriorityOrdered.
       sortPostProcessors(priorityOrderedPostProcessors, beanFactory);

       // priorityOrderedPostProcessors =&gt;
        // PropertySourcesPlaceholderConfigurer
       invokeBeanFactoryPostProcessors(priorityOrderedPostProcessors, beanFactory);

       // Next, invoke the BeanFactoryPostProcessors that implement Ordered.
       List&lt;BeanFactoryPostProcessor&gt; orderedPostProcessors = new ArrayList&lt;&gt;(orderedPostProcessorNames.size());
       for (String postProcessorName : orderedPostProcessorNames) {
          orderedPostProcessors.add(beanFactory.getBean(postProcessorName, BeanFactoryPostProcessor.class));
       }
       sortPostProcessors(orderedPostProcessors, beanFactory);

       // orderedPostProcessors =&gt; empty
       invokeBeanFactoryPostProcessors(orderedPostProcessors, beanFactory);

       // Finally, invoke all other BeanFactoryPostProcessors.
       List&lt;BeanFactoryPostProcessor&gt; nonOrderedPostProcessors = new ArrayList&lt;&gt;(nonOrderedPostProcessorNames.size());
       for (String postProcessorName : nonOrderedPostProcessorNames) {
          nonOrderedPostProcessors.add(beanFactory.getBean(postProcessorName, BeanFactoryPostProcessor.class));
       }
       // nonOrderedPostProcessors =&gt; 
        // EventListenerMethodProcessor
        // PreserveErrorControllerTargetClassPostProcessor
       invokeBeanFactoryPostProcessors(nonOrderedPostProcessors, beanFactory);

       // Clear cached merged bean definitions since the post-processors might have
       // modified the original metadata, e.g. replacing placeholders in values...
       beanFactory.clearMetadataCache();
    }
}
</code></pre>
<p>BeanDefinitionRegistryPostProcessor.postProcessBeanDefinitionRegistry实现类</p>
<pre><code class="language-text">ConfigurationClassPostProcessor
MapperScannerConfigurer
</code></pre>
<p>BeanFactoryPostProcessor.postProcessBeanFactory实现类</p>
<pre><code class="language-text">SharedMetadataReaderFactoryContextInitializer$CachingMetadataReaderFactoryPostProcessor
ConfigurationWarningsApplicationContextInitializer$ConfigurationWarningsPostProcessor
ConfigurationClassPostProcessor
MapperScannerConfigurer

ConfigFileApplicationListener$PropertySourceOrderingPostProcessor
PropertySourcePlaceholderConfigurer
EventListenerMethodProcessor
ErrorMvcAutoConfiguration$PreserveErrorControllerTargetClassPostProcessor
</code></pre>
<p>ConfigurationClassPostProcessor.postProcessBeanDefinitionRegistry方法</p>
<p>扫描包下文件注册beanDefinition</p>
<p>通过 ClassPathBeanDefinitionScanner执行</p>
<pre><code class="language-java">public class ClassPathBeanDefinitionScanner extends ClassPathScanningCandidateComponentProvider {
    protected Set&lt;BeanDefinitionHolder&gt; doScan(String... basePackages) {
        Assert.notEmpty(basePackages, &quot;At least one base package must be specified&quot;);
        Set&lt;BeanDefinitionHolder&gt; beanDefinitions = new LinkedHashSet&lt;&gt;();
        for (String basePackage : basePackages) {
            Set&lt;BeanDefinition&gt; candidates = findCandidateComponents(basePackage);
            for (BeanDefinition candidate : candidates) {
                ScopeMetadata scopeMetadata = this.scopeMetadataResolver.resolveScopeMetadata(candidate);
                candidate.setScope(scopeMetadata.getScopeName());
                String beanName = this.beanNameGenerator.generateBeanName(candidate, this.registry);
                if (candidate instanceof AbstractBeanDefinition) {
                    postProcessBeanDefinition((AbstractBeanDefinition) candidate, beanName);
                }
                if (candidate instanceof AnnotatedBeanDefinition) {
                    AnnotationConfigUtils.processCommonDefinitionAnnotations((AnnotatedBeanDefinition) candidate);
                }
                if (checkCandidate(beanName, candidate)) {
                    BeanDefinitionHolder definitionHolder = new BeanDefinitionHolder(candidate, beanName);
                    definitionHolder =
                            AnnotationConfigUtils.applyScopedProxyMode(scopeMetadata, definitionHolder, this.registry);
                    beanDefinitions.add(definitionHolder);
                    registerBeanDefinition(definitionHolder, this.registry);
                }
            }
        }
        return beanDefinitions;
    }
}
</code></pre>
<p>调用栈</p>
<pre><code class="language-text">doScan:273, ClassPathBeanDefinitionScanner (org.springframework.context.annotation)
parse:132, ComponentScanAnnotationParser (org.springframework.context.annotation)
doProcessConfigurationClass:296, ConfigurationClassParser (org.springframework.context.annotation)
processConfigurationClass:250, ConfigurationClassParser (org.springframework.context.annotation)
parse:207, ConfigurationClassParser (org.springframework.context.annotation)
parse:175, ConfigurationClassParser (org.springframework.context.annotation)
processConfigBeanDefinitions:320, ConfigurationClassPostProcessor (org.springframework.context.annotation)
postProcessBeanDefinitionRegistry:237, ConfigurationClassPostProcessor (org.springframework.context.annotation)
invokeBeanDefinitionRegistryPostProcessors:280, PostProcessorRegistrationDelegate (org.springframework.context.support)
invokeBeanFactoryPostProcessors:96, PostProcessorRegistrationDelegate (org.springframework.context.support)
invokeBeanFactoryPostProcessors:707, AbstractApplicationContext (org.springframework.context.support)
refresh:533, AbstractApplicationContext (org.springframework.context.support)
refresh:143, ServletWebServerApplicationContext (org.springframework.boot.web.servlet.context)
refresh:755, SpringApplication (org.springframework.boot)
refresh:747, SpringApplication (org.springframework.boot)
refreshContext:402, SpringApplication (org.springframework.boot)
run:312, SpringApplication (org.springframework.boot)
main:35, StartApplication (com.zuzuche.widget.start)
</code></pre>
<h3></h3>
        </article>
    </div>
</main>


<script>
    // 元素获取
    const chapterLinks = document.querySelectorAll('.chapter-link');
    const tocLinks = document.querySelectorAll('.toc-link');
    const sections = document.querySelectorAll('section, h3[id]');

    // 滚动监听，高亮当前章节和目录项
    window.addEventListener('scroll', () => {
        let current = '';

        // 找到当前可见的最高章节
        sections.forEach(section => {
            const sectionTop = section.offsetTop;
            const sectionHeight = section.clientHeight;

            if (window.scrollY >= (sectionTop - 150)) {
                current = section.getAttribute('id');
            }
        });

        // 更新左侧章节导航高亮
        chapterLinks.forEach(link => {
            link.classList.remove('active');
            if (link.getAttribute('href').substring(1) === current ||
                current.startsWith(link.getAttribute('href').substring(1) + '-')) {
                link.classList.add('active');
            }
        });

        // 更新右侧目录导航高亮
        tocLinks.forEach(link => {
            link.classList.remove('active');
            if (link.getAttribute('href').substring(1) === current) {
                link.classList.add('active');
            }
        });
    });
</script>
</body>
</html>
